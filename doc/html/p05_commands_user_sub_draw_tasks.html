<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Izg project: 05 Uživatelský příkaz, číslování a podcommand buffer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Izg project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('p05_commands_user_sub_draw_tasks.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">05 Uživatelský příkaz, číslování a podcommand buffer</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="userCommand"></a>
Úkol 2: - Uživatelský příkaz a číslování</h1>
<p>Cílem této části je zprovoznit uživatelský příkaz, kreslící příkazy a pod <a class="el" href="structCommandBuffer.html">CommandBuffer(y)</a>.</p>
<h2><a class="anchor" id="userCommandT"></a>
Test 11 - UserCommand</h2>
<div class="fragment"><div class="line">./izgProject -c --test 11</div>
</div><!-- fragment --><p> Tento test zkouší, zda jste naimplementovali obsluhu uživatelského příkazu: <a class="el" href="structUserCommand.html">UserCommand</a>. </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structUserCommand.html">UserCommand</a>{</div>
<div class="line">  <a class="code hl_typedef" href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a71ccc6fa3730a87e50bbb36079c57885">UserCommandFce</a> <a class="code hl_variable" href="structUserCommand.html#a864a70aee21a374b1797681e6ed24f33">callback</a> = <span class="keyword">nullptr</span>; </div>
<div class="line">  <span class="keywordtype">void</span>*          <a class="code hl_variable" href="structUserCommand.html#a39db386e467c298eba0a5b5ab0f72f1e">data</a>     = <span class="keyword">nullptr</span>; </div>
<div class="line">};</div>
<div class="ttc" id="asolutionInterface_2src_2solutionInterface_2gpu_8hpp_html_a71ccc6fa3730a87e50bbb36079c57885"><div class="ttname"><a href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a71ccc6fa3730a87e50bbb36079c57885">UserCommandFce</a></div><div class="ttdeci">void(*)(void *data) UserCommandFce</div><div class="ttdoc">[SetFrontFaceCommand]</div><div class="ttdef"><b>Definition</b> gpu.hpp:583</div></div>
<div class="ttc" id="astructUserCommand_html"><div class="ttname"><a href="structUserCommand.html">UserCommand</a></div><div class="ttdoc">This structure represents user command. User command can execute any task. It is usually not present ...</div><div class="ttdef"><b>Definition</b> gpu.hpp:595</div></div>
<div class="ttc" id="astructUserCommand_html_a39db386e467c298eba0a5b5ab0f72f1e"><div class="ttname"><a href="structUserCommand.html#a39db386e467c298eba0a5b5ab0f72f1e">UserCommand::data</a></div><div class="ttdeci">void * data</div><div class="ttdoc">user data for user function</div><div class="ttdef"><b>Definition</b> gpu.hpp:597</div></div>
<div class="ttc" id="astructUserCommand_html_a864a70aee21a374b1797681e6ed24f33"><div class="ttname"><a href="structUserCommand.html#a864a70aee21a374b1797681e6ed24f33">UserCommand::callback</a></div><div class="ttdeci">UserCommandFce callback</div><div class="ttdoc">user function</div><div class="ttdef"><b>Definition</b> gpu.hpp:596</div></div>
</div><!-- fragment --><p> Pokud grafická karta narazí na tento příkaz, měla by vyvolat callback a dát mu data. Pozor, uživatelský callback může být nullptr, v takovém případě se příkaz ignoruje.</p>
<h2><a class="anchor" id="drawIDTest"></a>
Test 12 - DrawCommand a počítání gl_DrawID</h2>
<div class="fragment"><div class="line">./izgProject -c --test 12</div>
</div><!-- fragment --><p> Tento test zkouší, zda jste naimplementovali obsluhu kreslícího příkazu: <a class="el" href="structDrawCommand.html">DrawCommand</a>. </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structDrawCommand.html">DrawCommand</a>{</div>
<div class="line">  uint32_t <a class="code hl_variable" href="structDrawCommand.html#a4a7376486faf9f07fccb7de82d86566b">nofVertices</a>     = 0    ; </div>
<div class="line">};</div>
<div class="ttc" id="astructDrawCommand_html"><div class="ttname"><a href="structDrawCommand.html">DrawCommand</a></div><div class="ttdoc">[ClearStencilCommand]</div><div class="ttdef"><b>Definition</b> gpu.hpp:473</div></div>
<div class="ttc" id="astructDrawCommand_html_a4a7376486faf9f07fccb7de82d86566b"><div class="ttname"><a href="structDrawCommand.html#a4a7376486faf9f07fccb7de82d86566b">DrawCommand::nofVertices</a></div><div class="ttdeci">uint32_t nofVertices</div><div class="ttdoc">number of vertices to draw</div><div class="ttdef"><b>Definition</b> gpu.hpp:474</div></div>
</div><!-- fragment --><p> Pokud grafická karta narazí na tento příkaz, měla by spustit kreslení. Každý vykreslovací příkaz je číslovaný vzestupně od počátku spuštění. Cílem tohoto testu je ověřit, že počítáte vykresovací příkazy (a nastavujete <a class="el" href="structGPUMemory.html#aa6541055bfd7af94a91f35bfe0cd9aad">GPUMemory::gl_DrawID</a>). Toto číslování se používá pro výběr materiálů, textur, modelových matic a podobně. Číslují se jen vykreslovací příkazy. Pokud je mezi kreslícími jiný příkaz, neovlivní to číslování. Výjimkou je příkaz <a class="el" href="structSetDrawIdCommand.html">SetDrawIdCommand</a>, který umožňuje explicitně <a class="el" href="structGPUMemory.html#aa6541055bfd7af94a91f35bfe0cd9aad">GPUMemory::gl_DrawID</a> nastavit. </p><div class="image">
<object type="image/svg+xml" data="gl_DrawID.svg" width="600" style="pointer-events: none;"></object>
<div class="caption">
Pouze kreslící příkazy jsou číslovány. SetDrawIdCommand může explicitně nastavit číslo příkazu. Je jedno, zda jsou příkazy součástí SubCommand, číslování to neovlivní.</div></div>
<p> Hrubý pseudokód může vypadat nějak takto: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="studentSolution_2src_2studentSolution_2gpu_8cpp.html#acb235bf1bd34504bf58828aac4d40b11">student_GPU_run</a>(<a class="code hl_struct" href="structGPUMemory.html">GPUMemory</a>&amp;mem,<a class="code hl_struct" href="structCommandBuffer.html">CommandBuffer</a> <span class="keyword">const</span>&amp;cb){</div>
<div class="line">  <span class="comment">// smyčka přes příkazy</span></div>
<div class="line">  <span class="keywordflow">for</span>(... commands ...){</div>
<div class="line">    <span class="comment">// vykreslovací příkaz</span></div>
<div class="line">    <span class="keywordflow">if</span> (commandType == <a class="code hl_enumvalue" href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352a2b4807f24940ca2fe73284bc6e864d66">CommandType::DRAW</a> ){</div>
<div class="line">      <span class="comment">// kresli</span></div>
<div class="line">      draw(mem, drawCommand);</div>
<div class="line">      <span class="comment">// počítadlo kreslících příkazů</span></div>
<div class="line">      mem.<a class="code hl_variable" href="structGPUMemory.html#aa6541055bfd7af94a91f35bfe0cd9aad">gl_DrawID</a>++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (commandType == <a class="code hl_enumvalue" href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352af33727905f5b6f48cac50cb735ed9524">CommandType::SET_DRAW_ID</a>){</div>
<div class="line">      mem.<a class="code hl_variable" href="structGPUMemory.html#aa6541055bfd7af94a91f35bfe0cd9aad">gl_DrawID</a> = ...</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="asolutionInterface_2src_2solutionInterface_2gpu_8hpp_html_a21e038f5b8958e203d28bc4f18472352a2b4807f24940ca2fe73284bc6e864d66"><div class="ttname"><a href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352a2b4807f24940ca2fe73284bc6e864d66">CommandType::DRAW</a></div><div class="ttdeci">@ DRAW</div><div class="ttdoc">draw command</div></div>
<div class="ttc" id="asolutionInterface_2src_2solutionInterface_2gpu_8hpp_html_a21e038f5b8958e203d28bc4f18472352af33727905f5b6f48cac50cb735ed9524"><div class="ttname"><a href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352af33727905f5b6f48cac50cb735ed9524">CommandType::SET_DRAW_ID</a></div><div class="ttdeci">@ SET_DRAW_ID</div><div class="ttdoc">set drawId command</div></div>
<div class="ttc" id="astructCommandBuffer_html"><div class="ttname"><a href="structCommandBuffer.html">CommandBuffer</a></div><div class="ttdoc">[Command]</div><div class="ttdef"><b>Definition</b> gpu.hpp:671</div></div>
<div class="ttc" id="astructGPUMemory_html"><div class="ttname"><a href="structGPUMemory.html">GPUMemory</a></div><div class="ttdoc">[BackfaceCulling]</div><div class="ttdef"><b>Definition</b> gpu.hpp:402</div></div>
<div class="ttc" id="astructGPUMemory_html_aa6541055bfd7af94a91f35bfe0cd9aad"><div class="ttname"><a href="structGPUMemory.html#aa6541055bfd7af94a91f35bfe0cd9aad">GPUMemory::gl_DrawID</a></div><div class="ttdeci">uint32_t gl_DrawID</div><div class="ttdoc">draw call id</div><div class="ttdef"><b>Definition</b> gpu.hpp:419</div></div>
<div class="ttc" id="astudentSolution_2src_2studentSolution_2gpu_8cpp_html_acb235bf1bd34504bf58828aac4d40b11"><div class="ttname"><a href="studentSolution_2src_2studentSolution_2gpu_8cpp.html#acb235bf1bd34504bf58828aac4d40b11">student_GPU_run</a></div><div class="ttdeci">void student_GPU_run(GPUMemory &amp;mem, CommandBuffer const &amp;cb)</div><div class="ttdoc">[student_GPU_run]</div><div class="ttdef"><b>Definition</b> gpu.cpp:12</div></div>
</div><!-- fragment --><h2><a class="anchor" id="subCmdPractice"></a>
Test 13 - sub command</h2>
<p>Testy: </p><div class="fragment"><div class="line">./izgProject -c --test 13</div>
</div><!-- fragment --><p> <a class="el" href="structSubCommand.html">SubCommand</a> je způsob, jak rozšiřovat a větvit <a class="el" href="structCommandBuffer.html">CommandBuffer</a>. <a class="el" href="structSubCommand.html">SubCommand</a> obsahuje ukazatel na další <a class="el" href="structCommandBuffer.html">CommandBuffer</a>. </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structSubCommand.html">SubCommand</a>{</div>
<div class="line">  <a class="code hl_struct" href="structCommandBuffer.html">CommandBuffer</a>*<a class="code hl_variable" href="structSubCommand.html#a6743a1b924763618d8c2fafd3b4decd5">commandBuffer</a> = <span class="keyword">nullptr</span>; </div>
<div class="line">};</div>
<div class="ttc" id="astructSubCommand_html"><div class="ttname"><a href="structSubCommand.html">SubCommand</a></div><div class="ttdoc">[BindVertexArrayCommand]</div><div class="ttdef"><b>Definition</b> gpu.hpp:523</div></div>
<div class="ttc" id="astructSubCommand_html_a6743a1b924763618d8c2fafd3b4decd5"><div class="ttname"><a href="structSubCommand.html#a6743a1b924763618d8c2fafd3b4decd5">SubCommand::commandBuffer</a></div><div class="ttdeci">CommandBuffer * commandBuffer</div><div class="ttdoc">pointer to secondary command buffer</div><div class="ttdef"><b>Definition</b> gpu.hpp:524</div></div>
</div><!-- fragment --><p> Koncept je podobný jako u sekundárních command bufferů ve Vulkánu: <a href="https://docs.vulkan.org/spec/latest/chapters/cmdbuffers.html#commandbuffers-secondary">Sekundární Command Buffer</a>. Příkladem využití <a class="el" href="structSubCommand.html">SubCommand</a> v tomto projektu je vykreslování stínů. Technika vykreslování stínů vyžaduje vykreslit scénu 2x, pokaždé s jiným programem a framebufferem. Je tak možné uložit si sub <a class="el" href="structCommandBuffer.html">CommandBuffer</a> pro vykreslení scény a ten pak dvakrát uložit v primárním <a class="el" href="structCommandBuffer.html">CommandBuffer(u)</a> pro celý snímek. <a class="el" href="structSubCommand.html">SubCommand</a> může být vložen v libovolné hloubce, tzn. sub command buffer může obsahovat sub command buffer. Hrubý pseudokód může vypadat nějak takto: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="studentSolution_2src_2studentSolution_2gpu_8cpp.html#acb235bf1bd34504bf58828aac4d40b11">student_GPU_run</a>(<a class="code hl_struct" href="structGPUMemory.html">GPUMemory</a>&amp;mem,<a class="code hl_struct" href="structCommandBuffer.html">CommandBuffer</a> <span class="keyword">const</span>&amp;cb){</div>
<div class="line">  <span class="comment">// smyčka přes příkazy</span></div>
<div class="line">  <span class="keywordflow">for</span>(... commands ...){</div>
<div class="line">    <span class="comment">// sub command</span></div>
<div class="line">    <span class="keywordflow">if</span> (commandType == <a class="code hl_enumvalue" href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352aadcc01dbaca0f0d3fb64ef8f45550ec3">CommandType::SUB_COMMAND</a>){</div>
<div class="line">      processSubCommandRecursive(commandData.subCommand.commandBuffer);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="asolutionInterface_2src_2solutionInterface_2gpu_8hpp_html_a21e038f5b8958e203d28bc4f18472352aadcc01dbaca0f0d3fb64ef8f45550ec3"><div class="ttname"><a href="solutionInterface_2src_2solutionInterface_2gpu_8hpp.html#a21e038f5b8958e203d28bc4f18472352aadcc01dbaca0f0d3fb64ef8f45550ec3">CommandType::SUB_COMMAND</a></div><div class="ttdeci">@ SUB_COMMAND</div><div class="ttdoc">sub command</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
