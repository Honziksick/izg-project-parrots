<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Izg project: 14 Ořez</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Izg project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('p14_pipeline_clipping.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">14 Ořez</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tento úkol opravuje vykreslování pokud je geometrie za pozorovatelem. Tyto úkoly můžete přeskočit a vrátit se k nim později. Pokud se na geometrii budete dívat tak, že leží vždy před vámi, nepoznáte rozdíl.</p>
<h1><a class="anchor" id="ClippingTheory"></a>
Teorie ořezu</h1>
<p>Ořez (clipping) slouží pro odstranění částí trojúhelníků, které leží mimo pohledový jehlan. Nejdůležitější je však ořez near ořezovou rovinou pohledoveho jehlanu. Pokud by se neprovedl ořez pomocí near roviny, pak by se vrcholy nebo i celé trojúhělníky, které leží za středem projekce promítly při perspektivním dělení na průmětnu. Ořez se provádí v clip-space - po Primitive Assembly jednotce. Pro body, které leží uvnitř pohledového tělesa platí, že jejich souřadnice splňují následující nerovnice: \( -A_w \leq A_i \leq +A_w \), \(i \in \left\{ x,y,z \right\}\). Těchto 6 nerovnic reprezentuje jednotlivé svěny pohledového jehlanu. Nerovnice \( -A_w \leq A_z \) reprezentuje podmínku pro near ořezovou rovinu. <br  />
 Při ořezu trojúhelníku můžou nastat 4 případy, jsou znázorněny na následujícím obrázku:</p>
<div class="image">
<object type="image/svg+xml" data="clip_variants.svg" style="pointer-events: none;"></object>
<div class="caption">
4 varianty ořezu trojúhelníku pomocí near roviny. Počet vrcholů, které leží před ořezovou rovinou určuje typ ořezu. Při ořezu může vzniknout 0 až 2 nové trojúhelníky.</div></div>
<p>Ořez trojúhelníku pomocí near roviny lze zjednodušit na ořez hran trojúhelníku. Bod na hraně (úsečce) trojúhelníku lze vyjádřit jako: \( \overrightarrow{X(t)} = \overrightarrow{A} + t \cdot (\overrightarrow{B}-\overrightarrow{A}) \), \(t \in [0,1] \). \( \overrightarrow{A}, \overrightarrow{B} \) jsou vrcholy trojúhelníka, \( \overrightarrow{X(t)} \) je bod na hraně a parametr \( t \) udává posun na úsečce.</p>
<div class="image">
<object type="image/svg+xml" data="clip.svg" style="pointer-events: none;"></object>
<div class="caption">
Ořez trojúhelníku pomocí ořezu hran. Při ořezu hran vzniknou nové body, ze kterých jsou následně sestaveny nové trojúhelníky.</div></div>
<p>Souřadnice bodu \( \overrightarrow{X(t)} \) lze určit při vypočtení parametru \( t \), při kterém přestane platit nerovnice pro near rovinu \( -X(t)_w \leq X(t)_z \). Takové místo nastává v situaci \( -X(t)_w = X(t)_z \). Po dosazení z rovnice úsečky lze vztah přepsat na:  </p><p class="formulaDsp">
\begin{eqnarray*}
-X(t)_w &amp;=&amp; X(t)_z \\
0 &amp;=&amp; X(t)_w + X(t)_z \\
0 &amp;=&amp; A_w + t \cdot (B_w-A_w) + A_z + t \cdot (B_z - A_z) \\
0 &amp;=&amp; A_w + A_z + t \cdot (B_w-A_w+B_z-A_z) \\
-A_w-A_z &amp;=&amp; t \cdot (B_w-A_w+B_z-A_z) \\
\frac{-A_w - A_z}{B_w-A_w+B_z-A_z} &amp;=&amp; t\\
\end{eqnarray*}
</p>
<p>Pozice bodu \( \overrightarrow{X(t)} \) a hodnoty dalších vertex atributů lze vypočítat lineární kombinací hodnot z vrcholů úsečky pomocí parametru \( t \) následovně: \( \overrightarrow{X(t)} = \overrightarrow{A} + t \cdot (\overrightarrow{B}-\overrightarrow{A}) \).</p>
<h1><a class="anchor" id="clip"></a>
Úkol 7 - naprogramovat ořez trojúhelníků blízkou ořezovou rovinou</h1>
<p>Testy, které kontrolují ořez, jsou 38. - 41: </p><div class="fragment"><div class="line">izgProject -c --test 41 --up-to-test 41</div>
</div><!-- fragment --><p> Pseudokód ořezu může vypadat takto: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> draw(mem,drawCommand){</div>
<div class="line">  <span class="keywordflow">for</span>(every triangle t){</div>
<div class="line">    Primitive primitive;</div>
<div class="line">    runPrimitiveAssembly(primitive,vertexArray,t,vertexShader)</div>
<div class="line"> </div>
<div class="line">    ClippedPrimitive clipped;</div>
<div class="line">    performeClipping(clipped,primitive);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(all clipped triangle c in clipped){</div>
<div class="line">      runPerspectiveDivision(c)</div>
<div class="line">      runViewportTransformation(c,width,height)</div>
<div class="line">      rasterizeTriangle(framebuffer,c,fragmentShader);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="studentSolution_2src_2studentSolution_2gpu_8cpp.html#acb235bf1bd34504bf58828aac4d40b11">student_GPU_run</a>(mem,commandBuffer){</div>
<div class="line">  <span class="keywordflow">for</span>(every command in commandBuffer){</div>
<div class="line">    <span class="keywordflow">if</span>(isDrawCommand )draw (mem,drawCommand)</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="astudentSolution_2src_2studentSolution_2gpu_8cpp_html_acb235bf1bd34504bf58828aac4d40b11"><div class="ttname"><a href="studentSolution_2src_2studentSolution_2gpu_8cpp.html#acb235bf1bd34504bf58828aac4d40b11">student_GPU_run</a></div><div class="ttdeci">void student_GPU_run(GPUMemory &amp;mem, CommandBuffer const &amp;cb)</div><div class="ttdoc">[student_GPU_run]</div><div class="ttdef"><b>Definition</b> gpu.cpp:12</div></div>
</div><!-- fragment --><h2><a class="anchor" id="clipping_all"></a>
Test 38 - ořez celého CW trojúhelníku, který je příliš blízko kamery.</h2>
<p>Tento test zkouší, zda funguje ořez celého trojúhelníka definovaného jako CC (clock wise). </p><div class="fragment"><div class="line">izgProject -c --test 38</div>
</div><!-- fragment --><h2><a class="anchor" id="clipping_0"></a>
Test 39 - ořez celého CCW trojúhelníku, který je příliš blízko kamery.</h2>
<p>Tento test zkouší, zda funguje ořez celého trojúhelníku definovaného jako CCW (counter clock wise) </p><div class="fragment"><div class="line">izgProject -c --test 39</div>
</div><!-- fragment --><h2><a class="anchor" id="clipping_1"></a>
Test 40 - Ořez trojúhelníku, když je 1 vrchol ořezán</h2>
<p>Tento test zkouší ořezat trojúhelník, když je mimo pohledové těleso jeden vrchol. </p><div class="fragment"><div class="line">izgProject -c --test 40</div>
</div><!-- fragment --><h2><a class="anchor" id="clipping_2"></a>
Test 41 - Ořez trojúhelníku, když jsou 2 vrcholy ořezány</h2>
<p>Tento test zkouší ořezat trojúhelník, když jsou mimo pohledové těloso dva vrcholy. </p><div class="fragment"><div class="line">izgProject -c --test 41</div>
</div><!-- fragment --><h1><a class="anchor" id="finalGPU"></a>
Hotová grafická karta</h1>
<p>Pokud budete mít ořez hotový, dokončili jste implementaci grafické karty! Byla to fuška, ale věřte, že skutečné grafické karty jsou alespoň milionkrát složitější. Takto vypadá celý vykreslovací řetězec:</p>
<div class="image">
<object type="image/svg+xml" data="rendering_pipeline.svg" style="pointer-events: none;"></object>
<div class="caption">
Simplified rendering pipeline</div></div>
<p> Měly by vám fungovat příklady, které nevyžadují načítání modelů: </p><div class="image">
<object type="image/svg+xml" data="examples.svg" width="1000" style="pointer-events: none;"></object>
<div class="caption">
příklady</div></div>
<p> Další úkoly jsou zaměřené už na vykreslování modelů s využitím stínů. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
