\chapter{14 Ořez}
\hypertarget{p14_pipeline_clipping}{}\label{p14_pipeline_clipping}\index{14 Ořez@{14 Ořez}}
Tento úkol opravuje vykreslování pokud je geometrie za pozorovatelem. Tyto úkoly můžete přeskočit a vrátit se k nim později. Pokud se na geometrii budete dívat tak, že leží vždy před vámi, nepoznáte rozdíl.\hypertarget{p14_pipeline_clipping_ClippingTheory}{}\doxysection{\texorpdfstring{Teorie ořezu}{Teorie ořezu}}\label{p14_pipeline_clipping_ClippingTheory}
Ořez (clipping) slouží pro odstranění částí trojúhelníků, které leží mimo pohledový jehlan. Nejdůležitější je však ořez near ořezovou rovinou pohledoveho jehlanu. Pokud by se neprovedl ořez pomocí near roviny, pak by se vrcholy nebo i celé trojúhělníky, které leží za středem projekce promítly při perspektivním dělení na průmětnu. Ořez se provádí v clip-\/space -\/ po Primitive Assembly jednotce. Pro body, které leží uvnitř pohledového tělesa platí, že jejich souřadnice splňují následující nerovnice\+: $ -A_w \leq A_i \leq +A_w $, $i \in \left\{ x,y,z \right\}$. Těchto 6 nerovnic reprezentuje jednotlivé svěny pohledového jehlanu. Nerovnice $ -A_w \leq A_z $ reprezentuje podmínku pro near ořezovou rovinu. ~\newline
 Při ořezu trojúhelníku můžou nastat 4 případy, jsou znázorněny na následujícím obrázku\+:



Ořez trojúhelníku pomocí near roviny lze zjednodušit na ořez hran trojúhelníku. Bod na hraně (úsečce) trojúhelníku lze vyjádřit jako\+: $ \overrightarrow{X(t)} = \overrightarrow{A} + t \cdot (\overrightarrow{B}-\overrightarrow{A}) $, $t \in [0,1] $. $ \overrightarrow{A}, \overrightarrow{B} $ jsou vrcholy trojúhelníka, $ \overrightarrow{X(t)} $ je bod na hraně a parametr $ t $ udává posun na úsečce.



Souřadnice bodu $ \overrightarrow{X(t)} $ lze určit při vypočtení parametru $ t $, při kterém přestane platit nerovnice pro near rovinu $ -X(t)_w \leq X(t)_z $. Takové místo nastává v situaci $ -X(t)_w = X(t)_z $. Po dosazení z rovnice úsečky lze vztah přepsat na\+:  \begin{eqnarray*}
-X(t)_w &=& X(t)_z \\
0 &=& X(t)_w + X(t)_z \\
0 &=& A_w + t \cdot (B_w-A_w) + A_z + t \cdot (B_z - A_z) \\
0 &=& A_w + A_z + t \cdot (B_w-A_w+B_z-A_z) \\
-A_w-A_z &=& t \cdot (B_w-A_w+B_z-A_z) \\
\frac{-A_w - A_z}{B_w-A_w+B_z-A_z} &=& t\\
\end{eqnarray*}

Pozice bodu $ \overrightarrow{X(t)} $ a hodnoty dalších vertex atributů lze vypočítat lineární kombinací hodnot z vrcholů úsečky pomocí parametru $ t $ následovně\+: $ \overrightarrow{X(t)} = \overrightarrow{A} + t \cdot (\overrightarrow{B}-\overrightarrow{A}) $.\hypertarget{p14_pipeline_clipping_clip}{}\doxysection{\texorpdfstring{Úkol 7 -\/ naprogramovat ořez trojúhelníků blízkou ořezovou rovinou}{Úkol 7 - naprogramovat ořez trojúhelníků blízkou ořezovou rovinou}}\label{p14_pipeline_clipping_clip}
Testy, které kontrolují ořez, jsou 38. -\/ 41\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{izgProject\ -\/c\ -\/-\/test\ 41\ -\/-\/up-\/to-\/test\ 41}

\end{DoxyCode}
 Pseudokód ořezu může vypadat takto\+: 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ draw(mem,drawCommand)\{}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{for}(every\ triangle\ t)\{}
\DoxyCodeLine{\ \ \ \ Primitive\ primitive;}
\DoxyCodeLine{\ \ \ \ runPrimitiveAssembly(primitive,vertexArray,t,vertexShader)}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ ClippedPrimitive\ clipped;}
\DoxyCodeLine{\ \ \ \ performeClipping(clipped,primitive);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}(all\ clipped\ triangle\ c\ in\ clipped)\{}
\DoxyCodeLine{\ \ \ \ \ \ runPerspectiveDivision(c)}
\DoxyCodeLine{\ \ \ \ \ \ runViewportTransformation(c,width,height)}
\DoxyCodeLine{\ \ \ \ \ \ rasterizeTriangle(framebuffer,c,fragmentShader);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{studentSolution_2src_2studentSolution_2gpu_8cpp_acb235bf1bd34504bf58828aac4d40b11}{student\_GPU\_run}}(mem,commandBuffer)\{}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{for}(every\ command\ in\ commandBuffer)\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}(isDrawCommand\ )draw\ (mem,drawCommand)}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
\hypertarget{p14_pipeline_clipping_clipping_all}{}\doxysubsection{\texorpdfstring{Test 38 -\/ ořez celého CW trojúhelníku, který je příliš blízko kamery.}{Test 38 - ořez celého CW trojúhelníku, který je příliš blízko kamery.}}\label{p14_pipeline_clipping_clipping_all}
Tento test zkouší, zda funguje ořez celého trojúhelníka definovaného jako CC (clock wise). 
\begin{DoxyCode}{0}
\DoxyCodeLine{izgProject\ -\/c\ -\/-\/test\ 38}

\end{DoxyCode}
\hypertarget{p14_pipeline_clipping_clipping_0}{}\doxysubsection{\texorpdfstring{Test 39 -\/ ořez celého CCW trojúhelníku, který je příliš blízko kamery.}{Test 39 - ořez celého CCW trojúhelníku, který je příliš blízko kamery.}}\label{p14_pipeline_clipping_clipping_0}
Tento test zkouší, zda funguje ořez celého trojúhelníku definovaného jako CCW (counter clock wise) 
\begin{DoxyCode}{0}
\DoxyCodeLine{izgProject\ -\/c\ -\/-\/test\ 39}

\end{DoxyCode}
\hypertarget{p14_pipeline_clipping_clipping_1}{}\doxysubsection{\texorpdfstring{Test 40 -\/ Ořez trojúhelníku, když je 1 vrchol ořezán}{Test 40 - Ořez trojúhelníku, když je 1 vrchol ořezán}}\label{p14_pipeline_clipping_clipping_1}
Tento test zkouší ořezat trojúhelník, když je mimo pohledové těleso jeden vrchol. 
\begin{DoxyCode}{0}
\DoxyCodeLine{izgProject\ -\/c\ -\/-\/test\ 40}

\end{DoxyCode}
\hypertarget{p14_pipeline_clipping_clipping_2}{}\doxysubsection{\texorpdfstring{Test 41 -\/ Ořez trojúhelníku, když jsou 2 vrcholy ořezány}{Test 41 - Ořez trojúhelníku, když jsou 2 vrcholy ořezány}}\label{p14_pipeline_clipping_clipping_2}
Tento test zkouší ořezat trojúhelník, když jsou mimo pohledové těloso dva vrcholy. 
\begin{DoxyCode}{0}
\DoxyCodeLine{izgProject\ -\/c\ -\/-\/test\ 41}

\end{DoxyCode}
\hypertarget{p14_pipeline_clipping_finalGPU}{}\doxysection{\texorpdfstring{Hotová grafická karta}{Hotová grafická karta}}\label{p14_pipeline_clipping_finalGPU}
Pokud budete mít ořez hotový, dokončili jste implementaci grafické karty! Byla to fuška, ale věřte, že skutečné grafické karty jsou alespoň milionkrát složitější. Takto vypadá celý vykreslovací řetězec\+:

 Měly by vám fungovat příklady, které nevyžadují načítání modelů\+:  Další úkoly jsou zaměřené už na vykreslování modelů s využitím stínů. 